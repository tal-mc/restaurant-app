name: Terraform Import ACI

on:
  workflow_dispatch: {}

env:
  TF_VAR_environment: dev  # or whatever your dev default is

jobs:
  import-aci:
    name: Import existing ACI into Terraform state
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.6.0  # match cd.yml

      - name: Terraform Init (same backend as CD)
        working-directory: terraform
        env:
          ARM_CLIENT_ID: ${{ fromJson(secrets.AZURE_CREDENTIALS).clientId }}
          ARM_CLIENT_SECRET: ${{ fromJson(secrets.AZURE_CREDENTIALS).clientSecret }}
          ARM_SUBSCRIPTION_ID: ${{ fromJson(secrets.AZURE_CREDENTIALS).subscriptionId }}
          ARM_TENANT_ID: ${{ fromJson(secrets.AZURE_CREDENTIALS).tenantId }}
        run: terraform init

      - name: Import existing ACI into state
        working-directory: terraform
        env:
          ARM_CLIENT_ID: ${{ fromJson(secrets.AZURE_CREDENTIALS).clientId }}
          ARM_CLIENT_SECRET: ${{ fromJson(secrets.AZURE_CREDENTIALS).clientSecret }}
          ARM_SUBSCRIPTION_ID: ${{ fromJson(secrets.AZURE_CREDENTIALS).subscriptionId }}
          ARM_TENANT_ID: ${{ fromJson(secrets.AZURE_CREDENTIALS).tenantId }}
        run: |
          terraform import \
            azurerm_container_group.api \
            "/subscriptions/f8919f3b-c46a-48a9-b70c-9234d33b5278/resourceGroups/rg-restaurant-api-dev/providers/Microsoft.ContainerInstance/containerGroups/ci-restaurant-api-dev"
